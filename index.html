<!doctype html>
<head>
  <meta charset="utf-8">

  <title>My Parse App</title>
  <meta name="description" content="My Parse App">
  <meta name="viewport" content="width=device-width">
  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
  <script type="text/javascript" src="http://www.parsecdn.com/js/parse-1.4.2.min.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
  <script type="text/javascript" src="js/View.js"></script>
</head>

<body>
  <!-- // Step 4-1 加上 signup 跟 login  的 html 結構 -->
  <div id="user">
    <div class="container">
      <div class="row">
        <!-- // Step 4-1-1  signUp 的結構 -->
        <form id="signUpForm" class="form-inline" role="form">
          <div class="form-group">
            <label for="signUpEmail">Sign Up Email</label>
            <input type="email" class="form-control" id="signUpEmail" placeholder="Sign Up Email" required>
          </div>
          <div class="form-group">
            <label class="sr-only" for="signUpPsd">Sign Up Password</label>
            <input type="password" class="form-control" id="signUpPsd" placeholder="Sign Up Password">
          </div>
          <button type="submit" id="signUpBtn" class="btn btn-default">Sign Up</button>
        </form>
      </div>
      <div class="row">
        <!-- // Step 4-1-2  logIn 的結構 -->
        <form  id="logInForm" class="form-inline" role="form">
          <div class="form-group">
            <label class="" for="logInEmail">Log In Email</label>
            <input type="email" class="form-control" id="logInEmail" placeholder="Log  In Email">
          </div>
          <div class="form-group">
            <label class="sr-only" for="logInPsd">Log In Password</label>
            <input type="password" class="form-control" id="logInPsd" placeholder="Log  In Password">
          </div>
          <button type="submit" id="signUpBtn" class="btn btn-default">Log In</button>
        </form>
      </div>
      <div class="row">
        <!-- // Step 4-1-2  logIn 的結構 -->
        <h2 id="currentUserName">
        </h2>
      </div>
    </div>
  </div>

  <div id="main">
    Step 1 : 建造一筆課程  <br>
    Step 2 : 抓取所有課程
  </div>



  <script type="text/javascript">
    Parse.initialize("1HTuCvw5oTUDbnyw3hfiw4gGImsVognwKbwmlIbo", "0bufSRt1H3cGSCzgud3a9KadZndVS07cAzowIDE7");


    // Step 1 : 建造一筆課程
    var Course = Parse.Object.extend("Course") ;
    // var course1 = new Course();

    // course.set("name","course1");
    // course.set("time","ㄧEFG");
    // course.set("credit",3);           // 也可以儲存數字

    // course.save(null,{
    //   success : function(course){     // 儲存成功後會執行的 callback
    //     console.log(course);
    //     alert("course save successfully!");
    //   },
    //   error : function(course,error){ // 儲存失敗後會執行的 callback
    //     console.log(error) ;
    //     alert(error.message);
    //   }
    // })

    // Step 2 : 抓取所有課程
    var allCourseQuery = new Parse.Query(Course)      // 創建 Course Query

    allCourseQuery.find({
      success: function(CourseArray) {
        console.log(CourseArray);

        // Step 3 : 顯示課程資料
        for (var i = 0 ; i < CourseArray.length ; i++){
          course = CourseArray[i] ;
          View.addRow(course.get('name'),course.get('time'),course.get('credit'))
        }
      },
      error: function(error) {
        console.log(error) ;
        alert(error.message);
      }
    });

    // Step 4-2 : 讓使用者可以註冊

    $(document).on('submit','#signUpForm',function(e){

      var user = new Parse.User();
      user.set("username", $('#signUpEmail').val());
      user.set("email",    $('#signUpEmail').val());
      user.set("password", $('#signUpPsd').val());

      user.signUp(null,{              // username ,email , passwod 都要有
        success : function(user){     // 註冊成功後會執行的 callback
          console.log(user);
          View.showFavoriteBtn();     // 註冊成功之後，開啟可以點選喜歡的系統
          alert("使用者註冊成功");

          // 注意一件事情，註冊之後，會自動當作使用者已經登入。
        },
        error : function(course,error){ // 註冊失敗後會執行的 callback
          console.log(error) ;
          alert(error.message);
        }
      });//endof signUp

      return false     // 避免 form submit 完成 轉址

    });  //endof  onSubmit






  </script>
</body>

</html>
